#cloud-config
autoinstall:
  version: 1
  locale: en_US.UTF-8
  keyboard:
    layout: us
  ssh:
    install-server: true
    allow-pw: true
  identity:
    hostname: {{ autoinstall_hostname | default('ubuntu-server') }}
    username: {{ bootstrap_user }}
    # Must be a crypt(3) hash, e.g. generated by: mkpasswd --method=SHA-512
    password: "{{ autoinstall_password_hash }}"
  user-data:
    disable_root: false
    ssh_pwauth: true
    users:
      - default
      - name: {{ bootstrap_user }}
        groups: [sudo]
        shell: /bin/bash
        lock_passwd: false
        passwd: "{{ autoinstall_password_hash }}"
  late-commands:
    - curtin in-target --target=/target -- bash -c "echo '{{ bootstrap_user }} ALL=(ALL) NOPASSWD:ALL' >/etc/sudoers.d/90-{{ bootstrap_user }}"
    - curtin in-target --target=/target -- chmod 0440 /etc/sudoers.d/90-{{ bootstrap_user }}
