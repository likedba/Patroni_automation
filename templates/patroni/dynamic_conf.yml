loop_wait: 10
maximum_lag_on_failover: 1048576
postgresql:
  parameters:
    archive_command: /bin/true
    archive_mode: true
    bgwriter_delay: 200ms
    bgwriter_flush_after: 0
    bgwriter_lru_maxpages: 100
    bgwriter_lrumultiplier: 2.0
    checkpoint_completion_target: 0.9
    checkpoint_timeout: 15 min
    effective_cache_size: {{ effective_cache_size }}
    effective_io_concurrency: 100
    enable_partitionwise_aggregate: true
    enable_partitionwise_join: true
    jit: true
    log_connections: true
    log_destination: 'stderr,syslog'
    logging_collector: true
    log_min_duration_statement: 1000
    log_disconnections: true
    log_line_prefix: '%m [%p] %q%u@%d/%a '
    log_filename: 'postgresql-%Y-%m-%d_%H%M%S.log'
    log_retention: '31d' 
    log_statement: DDL
    maintenance_io_concurrency: 100
    maintenance_work_mem: {{ maintenance_work_mem }}
    max_parallel_maintenance_workers: 5
    max_parallel_workers: 10
    max_parallel_workers_per_gather: 5
    max_slot_wal_keep_size: 1000 MB
    max_wal_size: 4 GB
    max_worker_processes: 10
    min_wal_size: 512 MB
    parallel_leader_participation: true
    random_page_cost: 1.25
    shared_buffers: {{ shared_buffers }}
    shared_preload_libraries: pg_stat_statements
    track_wal_io_timing: true
    wal_buffers: -1
    wal_compression: true
    wal_recycle: true
    wal_writer_delay: 200ms
    wal_writer_flush_after: 1MB
    work_mem: {{ work_mem }}
  pg_hba:
  - local all postgres peer
  - local all all scram-sha-256
  - host all all 127.0.0.1/32 scram-sha-256
  - local replication all scram-sha-256
  - host replication all 127.0.0.1/32 scram-sha-256
  - host replication replicator 127.0.0.1/32 scram-sha-256
  - host replication replicator {{ patroni1_ip }}/32 scram-sha-256
  - host replication replicator {{ patroni2_ip }}/32 scram-sha-256
  - host replication replicator {{ patroni3_ip }}/32 scram-sha-256
  - host all all {{ patroni1_ip }}/32 scram-sha-256
  - host all all {{ patroni2_ip }}/32 scram-sha-256
  - host all all {{ patroni3_ip }}/32 scram-sha-256
  {{ ldap_hba | default('') }}
  {{ dba1_hba | default('') }}
  {{ dba2_hba | default('') }}
  {{ dba3_hba | default('') }}
  {{ dba4_hba | default('') }}
  {{ app1_hba | default('') }}
  {{ app2_hba | default('') }}
  {{ app3_hba | default('') }}
  {{ app4_hba | default('') }}
  {{ app5_hba | default('') }}
  {{ app6_hba | default('') }}
  use_pg_rewind: true
  use_slots: true
retry_timeout: 10
synchronous_mode: true
ttl: 30
