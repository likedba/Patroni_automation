loop_wait: 10
maximum_lag_on_failover: 1048576
postgresql:
  parameters:
    archive_command: /bin/true
    archive_mode: true
    bgwriter_delay: 200ms
    bgwriter_flush_after: 0
    bgwriter_lru_maxpages: 100
    bgwriter_lrumultiplier: 2.0
    checkpoint_completion_target: 0.9
    checkpoint_timeout: 15 min
    effective_cache_size: 1 GB
    effective_io_concurrency: 100
    enable_partitionwise_aggregate: true
    enable_partitionwise_join: true
    jit: true
    log_connections: true
    log_destination: 'stderr,syslog'
    logging_collector: true
    log_min_duration_statement: 1000
    log_disconnections: true
    log_line_prefix: '%m [%p] %q%u@%d/%a '
    log_filename: 'postgresql-%Y-%m-%d_%H%M%S.log'
    log_retention: '31d'
    log_statement: DDL
    maintenance_io_concurrency: 100
    maintenance_work_mem: 320 MB
    max_parallel_maintenance_workers: 1
    max_parallel_workers: 2
    max_parallel_workers_per_gather: 2
    max_slot_wal_keep_size: 1000 MB
    max_wal_size: 1024 MB
    max_worker_processes: 10
    min_wal_size: 512 MB
    parallel_leader_participation: true
    random_page_cost: 1.25
    shared_buffers: 512 MB
    shared_preload_libraries: pg_stat_statements
    track_wal_io_timing: true
    wal_buffers: -1
    wal_compression: true
    wal_recycle: true
    wal_writer_delay: 200ms
    wal_writer_flush_after: 1MB
    work_mem: 32 MB
  pg_hba:
  - local all postgres peer
  - local all all scram-sha-256
  - host all all 127.0.0.1/32 scram-sha-256
  - local replication all scram-sha-256
  - host replication all 127.0.0.1/32 scram-sha-256
  - host replication replicator ::1/128 scram-sha-256
  - host replication replicator 127.0.0.1/32 scram-sha-256
  - host replication replicator {{ node1_ip }}/32 scram-sha-256
  - host replication replicator {{ node2_ip }}/32 scram-sha-256
  - host replication replicator {{ node3_ip }}/32 scram-sha-256
  - host all all {{ node1_ip }}/32 scram-sha-256
  - host all all {{ node2_ip }}/32 scram-sha-256
  - host all all {{ node3_ip }}/32 scram-sha-256
{% for server in app_servers %}
  - host {{ app_db_name }} {{ app_user }} {{ server.ip }}/32 scram-sha-256
{% endfor %}
  use_pg_rewind: true
  use_slots: true
retry_timeout: 10
synchronous_mode: true
ttl: 30
