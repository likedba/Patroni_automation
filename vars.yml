---
# =========================
# Project
# =========================
domain: "infra.local"

# =========================
# Cluster settings
# =========================
project_name: "test"
app_user: "wp_user"
app_db_name: "wordpress_db"

# Servers allowed to connect to app_db_name (for pg_hba)
app_servers:
  - { name: "vmubuntu-3", ip: "192.168.1.143" }
  - { name: "vmubuntu-4", ip: "192.168.1.144" }

# Derived from patroni_vms — do not edit directly
node1_hostname: "{{ patroni_vms[0].name }}"
node2_hostname: "{{ patroni_vms[1].name }}"
node3_hostname: "{{ patroni_vms[2].name }}"
node1_ip: "{{ patroni_vms[0].ip }}"
node2_ip: "{{ patroni_vms[1].ip }}"
node3_ip: "{{ patroni_vms[2].ip }}"

# =========================
# vCenter
# =========================
vcenter_hostname: "vcenter"                        # 192.168.1.140
vcenter_username: "administrator@vsphere.local"
vcenter_validate_certs: false
vcenter_datacenter: "Home Lab"
vcenter_datastore: "datastore1"
vcenter_folder: "/Home Lab/vm"
vcenter_network: "VM Network"
vcenter_template: "ubuntu_template"
vcenter_esxi_host: "192.168.1.83"                  # физический ESXi хост внутри vCenter (зарегистрирован по IP)

# =========================
# VM hardware
# Disk не указываем — наследуется из шаблона
# =========================
vm_cpu: 2
vm_ram_mb: 2048
vm_hardware_version: 21
vm_guest_id: "ubuntu64Guest"

# =========================
# VM network
# =========================
vm_netmask: "255.255.255.0"
vm_gateway: "192.168.1.1"
vm_dns_servers:
  - "192.168.1.146"

# =========================
# Patroni VMs
# =========================
patroni_vms:
  - { name: "vmpatronidb-1", ip: "192.168.1.135" }
  - { name: "vmpatronidb-2", ip: "192.168.1.136" }
  - { name: "vmpatronidb-3", ip: "192.168.1.137" }

# =========================
# Infra VMs
# =========================
infra_vms:
  - { name: "vmubuntu-1", ip: "192.168.1.141" }
  - { name: "vmubuntu-2", ip: "192.168.1.142" }
  - { name: "vmubuntu-3", ip: "192.168.1.143" }
  - { name: "vmubuntu-4", ip: "192.168.1.144" }
  - { name: "vmubuntu-7", ip: "192.168.1.147" }
  - { name: "vmubuntu-8", ip: "192.168.1.148" }

# =========================
# Vault secrets (secret/patroni_dpl)
# =========================
vcenter_password: "{{ lookup('ansible.builtin.pipe', 'vault kv get -field=esxi_pass secret/patroni_dpl') | trim }}"
aleksei_user_pass: "{{ lookup('ansible.builtin.pipe', 'vault kv get -field=aleksei_user_pass secret/patroni_dpl') | trim }}"

# =========================
# Vault secrets — cluster passwords (secret/patroni_dpl/<project_name>/)
# =========================
admin_pass: "{{ lookup('ansible.builtin.pipe', 'vault kv get -field=admin_pass secret/patroni_dpl/' ~ project_name ~ '/') | trim }}"
replicator_pass: "{{ lookup('ansible.builtin.pipe', 'vault kv get -field=replicator_pass secret/patroni_dpl/' ~ project_name ~ '/') | trim }}"
postgres_pass: "{{ lookup('ansible.builtin.pipe', 'vault kv get -field=postgres_pass secret/patroni_dpl/' ~ project_name ~ '/') | trim }}"
rewind_pass: "{{ lookup('ansible.builtin.pipe', 'vault kv get -field=rewind_pass secret/patroni_dpl/' ~ project_name ~ '/') | trim }}"
app_user_pass: "{{ lookup('ansible.builtin.pipe', 'vault kv get -field=' ~ app_user ~ '_pass secret/patroni_dpl/' ~ project_name ~ '/') | trim }}"
